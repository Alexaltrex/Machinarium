var X_last,Y_last,i_last,j_last,X_slct,Y_slct,i_slct,j_slct,NNN,Dimension=5,GameField=[],Chain=[],FirstSquareIsSelected=!1,SelectSquareArroundLast=!1,GameFieldIsFull=!1,canvas=document.getElementById("c1"),ctx=canvas.getContext("2d"),NumberOfRed=1,ArrRed=[];function DrawGameField(){ctx.clearRect(0,0,canvas.width,canvas.height);var e=new Image;e.onload=function(){for(var i=0;i<Dimension;i++)for(var a=0;a<Dimension;a++)ctx.drawImage(e,50*i,50*a,50,50)},e.src="img/Square.jpg"}function DrawArray(e,i){if(i>0&&0==GameField[i-1][e]){var a=new Image;a.onload=function(){ctx.drawImage(a,50*e,50*(i-1),50,50)},a.src="img/Arrow_Up.svg"}if(i<Dimension-1&&0==GameField[i+1][e]){var s=new Image;s.onload=function(){ctx.drawImage(s,50*e,50*(i+1),50,50)},s.src="img/Arrow_Down.svg"}if(e<Dimension-1&&0==GameField[i][e+1]){var t=new Image;t.onload=function(){ctx.drawImage(t,50*(e+1),50*i,50,50)},t.src="img/Arrow_Right.svg"}if(e>0&&0==GameField[i][e-1]){var n=new Image;n.onload=function(){ctx.drawImage(n,50*(e-1),50*i,50,50)},n.src="img/Arrow_Left.svg"}}function DeleteOldArrow(){for(let i=0;i<Dimension;i++)for(let a=0;a<Dimension;a++)if(0==GameField[i][a]){var e=new Image;e.onload=function(){ctx.drawImage(e,50*a,50*i,50,50)},e.src="img/Square.jpg"}}GameFieldIsFull=function(){var e=!0;for(let i=0;i<Dimension;i++)for(let a=0;a<Dimension;a++)0==GameField[i][a]&&(e=!1);return e};function YourWin(){var e=new Image;e.onload=function(){ctx.drawImage(e,0,0,250,250)},e.src="img/Win.svg"}function NextChoiceIsEnable(e,i){var a=!1;return e>0&&0==GameField[e-1][i]&&(a=!0),e<Dimension-1&&0==GameField[e+1][i]&&(a=!0),i>0&&0==GameField[e][i-1]&&(a=!0),i<Dimension-1&&0==GameField[e][i+1]&&(a=!0),a}function YourLose(){var e=new Image;e.onload=function(){ctx.drawImage(e,0,0,250,250)},e.src="img/Lose.svg"}function New_game(){NNN=NumberOfRed;for(let e=0;e<Dimension;e++){GameField[e]=[];for(let i=0;i<Dimension;i++)GameField[e][i]=0}for(var e=0;e<(Dimension+1)*(Dimension+1)-1;e++)Chain[e]=[0,0];FirstSquareIsSelected=!1,SelectSquareArroundLast=!1,GameFieldIsFull=!1,DrawGameField();var i=[];for(let e=0;e<NumberOfRed;e++){i[e]=[];for(let a=0;a<2;a++)i[e][a]=0}for(var a=0;a<NumberOfRed;a++)if(0==a&&(i[0][0]=Math.floor(Math.random()*Dimension),i[0][1]=Math.floor(Math.random()*Dimension)),a>0)do{i[a][0]=Math.floor(Math.random()*Dimension),i[a][1]=Math.floor(Math.random()*Dimension);var s=!0;for(let e=0;e<a;e++)i[e][0]==i[a][0]&&i[e][1]==i[a][1]&&(s=!1)}while(0==s);var t=new Image;t.onload=function(){for(var e=0;e<NumberOfRed;e++)GameField[i[e][1]][i[e][0]]=1,ctx.drawImage(t,50*i[e][0],50*i[e][1],50,50),console.log(i[e])},t.src="img/Square_Red.jpg"}document.querySelector("#c1").onmousedown=function(e){if(e=e||window.event,X_slct=50*Math.floor(e.offsetX/50),Y_slct=50*Math.floor(e.offsetY/50),i_slct=Math.floor(e.offsetX/50),j_slct=Math.floor(e.offsetY/50),SelectSquareArroundLast=0==FirstSquareIsSelected||Math.pow(i_slct-i_last,2)+Math.pow(j_slct-j_last,2)==1,console.log("SelectSquareArroundLast = "+SelectSquareArroundLast),console.log("FirstSquareIsSelected = "+FirstSquareIsSelected),0==FirstSquareIsSelected||1==FirstSquareIsSelected&&0==GameField[j_slct][i_slct]&&1==SelectSquareArroundLast){if(DeleteOldArrow(),0==FirstSquareIsSelected){var i=new Image;i.onload=function(){ctx.drawImage(i,X_slct,Y_slct,50,50)},i.src="img/Square_Green.jpg",DrawArray(i_last=i_slct,j_last=j_slct),console.log("i_last = "+i_last+"; j_last = "+j_last),GameField[j_slct][i_slct]=1,FirstSquareIsSelected=!0,NNN+=1}if(1==FirstSquareIsSelected){var a;if(i_slct==i_last&&j_slct-j_last==-1)(a=new Image).onload=function(){for(var e=j_slct;0==GameField[e][i_slct];)if(ctx.drawImage(a,50*i_slct,50*e,50,50),GameField[e][i_slct]=1,j_last=e,NNN+=1,-1===--e){j_last=0;break}i_last=i_slct,console.log("NextChoiceIsEnable - "+NextChoiceIsEnable(j_last,i_last)),0==NextChoiceIsEnable(j_last,i_last)&&NNN<Dimension*Dimension&&YourLose(),NNN==Dimension*Dimension&&YourWin(),NNN<Dimension*Dimension&&DrawArray(i_last,j_last)},a.src="img/Square_Yellow.jpg";if(i_slct==i_last&&j_slct-j_last==1)(a=new Image).onload=function(){for(var e=j_slct;0==GameField[e][i_slct];)if(ctx.drawImage(a,50*i_slct,50*e,50,50),GameField[e][i_slct]=1,NNN+=1,j_last=e,++e===Dimension){j_last=Dimension-1;break}NNN==Dimension*Dimension&&YourWin(),i_last=i_slct,console.log("NextChoiceIsEnable - "+NextChoiceIsEnable(j_last,i_last)),0==NextChoiceIsEnable(j_last,i_last)&&NNN<Dimension*Dimension&&YourLose(),NNN<Dimension*Dimension&&DrawArray(i_last,j_last)},a.src="img/Square_Yellow.jpg";if(j_slct==j_last&&i_slct-i_last==1)(a=new Image).onload=function(){for(var e=i_slct;0==GameField[j_slct][e];)if(ctx.drawImage(a,50*e,50*j_slct,50,50),GameField[j_slct][e]=1,(NNN+=1)==Dimension*Dimension&&YourWin(),i_last=e,++e===Dimension){i_last=Dimension-1;break}NNN==Dimension*Dimension&&YourWin(),j_last=j_slct,console.log("NextChoiceIsEnable - "+NextChoiceIsEnable(j_last,i_last)),0==NextChoiceIsEnable(j_last,i_last)&&NNN<Dimension*Dimension&&YourLose(),NNN<Dimension*Dimension&&DrawArray(i_last,j_last)},a.src="img/Square_Yellow.jpg";if(j_slct==j_last&&i_slct-i_last==-1)(a=new Image).onload=function(){for(var e=i_slct;0==GameField[j_slct][e];)if(ctx.drawImage(a,50*e,50*j_slct,50,50),GameField[j_slct][e]=1,NNN+=1,i_last=e,-1===--e){i_last=0;break}j_last=j_slct,NNN==Dimension*Dimension&&YourWin(),console.log("NextChoiceIsEnable - "+NextChoiceIsEnable(j_last,i_last)),NNN<Dimension*Dimension&&DrawArray(i_last,j_last),0==NextChoiceIsEnable(j_last,i_last)&&NNN<Dimension*Dimension&&YourLose()},a.src="img/Square_Yellow.jpg"}}},window.onload=New_game(),document.getElementById("input").addEventListener("click",New_game);